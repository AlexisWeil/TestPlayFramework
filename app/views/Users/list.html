#{extends 'main.html' /}

Users' list :
<ul>
    #{list items:users, as:'user'}
        <li>${user.firstname} ${user.lastname}</li>
    #{/list}
</ul>

Add a new user :

#{form @Users.addUser()}
    <label for="AddUserFirstname">Firstname : </label>
    <input id="AddUserFirstname" type="text" name="user.firstname" value="${flash['user.firstname']}" />
    #{ifError 'user.firstname'}<span style="color: red;">Firstname is required</span>#{/ifError}<br/><br/>

    <label for="AddUserLastname">Lastname : </label>
    <input id="AddUserLastname" type="text" name="user.lastname" value="${flash['user.lastname']}"/>
    #{ifError 'user.lastname'}<span style="color: red;">Lastname is required</span>#{/ifError}<br/><br/>

    <input type="submit" value="Submit" id="AddUserSubmit" />
#{/form}

<script type="text/javascript">

    $(function() {
        $('input[type="submit"]').click(function(event) {
            event.preventDefault();

            var form = $(this).parents('form').eq(0);

            sendAjaxForm(form, function() { alert("hello"); });
        });
    });

    function sendAjaxForm(form, callback) {
        var url = form.attr('action') + "?" + form.serialize();

        $.getJSON(
                url,
                function(json) {
                    var valid = true;

                    for(var key in json) {
                        if(key == "id" && json[key] == "ValidationErrors") {
                            for(var e in json["errors"]) {
                                var error = json["errors"][e];

                                var input = form.find('[name="' + error['id'] + '"]').css("border", "1px solid red");
                            }

                            valid = false;
                        }
                    }

                    if(valid && callback != undefined) {
                        callback(json);
                    }
                }
        );
    }

    function addUserAjax() {

        var firstname = $('#AddUserFirstname').val();
        var lastname = $('#AddUserLastname').val();

        alert()

        $.getJSON(
            addUserUrl({ firstname: firstname, lastname: lastname}),
            function(json) {
                alert(json);
            }
        );
    }
</script>